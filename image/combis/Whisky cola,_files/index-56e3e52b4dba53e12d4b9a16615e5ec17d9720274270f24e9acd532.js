function comments_thread(e,t,n){return $.ajax({url:$(n).attr("href"),method:"GET",processData:!1,contentType:!1,dataType:"html"}).done(function(e){$(n).replaceWith(e)}),e.stopPropagation(),e.preventDefault(),!1}function readModal(){var e;"comment"===document.getElementById("type_answer").value?(null!=(e=document.getElementById("modal_video").value)&&(document.getElementsByName("images[]").values=null),document.getElementById("video_url").value=e,hiddenTick()):(null!=(e=document.getElementById("modal_video").value)&&(document.getElementsByName("images[]").values=null),document.getElementById("video_url_comment").value=e,hiddenTickcomment())}function readHidden(e){var t=document.getElementById(e).value;document.getElementById("modal_video").value=t}function hiddenTick(){""!==document.getElementById("video_url").value?document.getElementById("videoOutput").style.display="flex":document.getElementById("videoOutput").style.display="none"}function hiddenTickcomment(){""!==document.getElementById("video_url_comment").value?document.getElementById("videoOutputComment").style.display="flex":document.getElementById("videoOutputComment").style.display="none"}function validURL(e){var t=e.currentTarget.value,n=new RegExp(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$/),o=new RegExp(/^(?:https?:\/\/)?(?:www\.)?dailymotion\.com\/video/),a=new RegExp(/^(?:https?:\/\/)?(?:www\.)?vk\.com\/video/);n.test(t)||o.test(t)||a.test(t)?(document.getElementById("modal_video").style.borderColor="green",document.getElementsByClassName("done_modal")[0].style.pointerEvents="all",document.getElementsByClassName("done_modal")[0].style.backgroundColor="#2ecc71",document.getElementsByClassName("done_modal")[0].style.borderColor="#2ecc71"):(document.getElementById("modal_video").style.borderColor="red",document.getElementsByClassName("done_modal")[0].style.pointerEvents="none",document.getElementsByClassName("done_modal")[0].style.backgroundColor="lightgrey",document.getElementsByClassName("done_modal")[0].style.borderColor="lightgrey")}function setupCollapse(e){e.addEventListener("click",function(){e.parentElement.classList.add("hidden"),e.parentElement.parentElement.childNodes.forEach(function(e){"answers__collapsed_placeholder"===e.className&&(e.classList.add("active"),expandCollapse(e))})})}function setReturnToTargetEvent(e){e.addEventListener("click",function(){document.getElementById(this.getAttribute("data-target")).scrollIntoView({behavior:"smooth"})})}function expandCollapse(e){e.addEventListener("click",function(){Array.from(this.parentElement.getElementsByClassName("answers__content")).forEach(function(e){e.classList.remove("hidden")}),Array.from(this.parentElement.getElementsByClassName("answers__collapsed_placeholder")).forEach(function(e){e.classList.remove("active")})})}function checkNesting(e){$(e).parents(".comment").length>=5&&removeAnswerAbility(e)}function removeAnswerAbility(e){$(e).find(".comment__reply").addClass("hidden")}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.MicroModal=t()}(this,function(){"use strict";var e,t,n,o,a,i,l,d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};return e=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],t=function(){function t(e){var n=e.targetModal,o=e.triggers,a=void 0===o?[]:o,i=e.onShow,l=void 0===i?function(){}:i,s=e.onClose,m=void 0===s?function(){}:s,c=e.openTrigger,u=void 0===c?"data-micromodal-trigger":c,f=e.closeTrigger,v=void 0===f?"data-micromodal-close":f,g=e.disableScroll,p=void 0!==g&&g,y=e.disableFocus,h=void 0!==y&&y,E=e.awaitCloseAnimation,_=void 0!==E&&E,b=e.debugMode,w=void 0!==b&&b;d(this,t),this.modal=document.getElementById(n),this.config={debugMode:w,disableScroll:p,openTrigger:u,closeTrigger:v,onShow:l,onClose:m,awaitCloseAnimation:_,disableFocus:h},a.length>0&&this.registerTriggers.apply(this,r(a)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}return s(t,[{key:"registerTriggers",value:function(){for(var e=this,t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];n.filter(Boolean).forEach(function(t){t.addEventListener("click",function(){return e.showModal()})})}},{key:"showModal",value:function(){this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add("is-open"),this.setFocusToFirstNode(),this.scrollBehaviour("disable"),this.addEventListeners(),this.config.onShow(this.modal)}},{key:"closeModal",value:function(){var e=this.modal;this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.scrollBehaviour("enable"),this.activeElement&&this.activeElement.focus(),this.config.onClose(this.modal),this.config.awaitCloseAnimation?this.modal.addEventListener("animationend",function t(){e.classList.remove("is-open"),e.removeEventListener("animationend",t,!1)},!1):e.classList.remove("is-open")}},{key:"closeModalById",value:function(e){this.modal=document.getElementById(e),this.modal&&this.closeModal()}},{key:"scrollBehaviour",value:function(e){if(this.config.disableScroll){var t=document.querySelector("body");switch(e){case"enable":Object.assign(t.style,{overflow:"",height:""});break;case"disable":Object.assign(t.style,{overflow:"hidden",height:"100vh"})}}}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(e){e.target.hasAttribute(this.config.closeTrigger)&&(this.closeModal(),e.preventDefault())}},{key:"onKeydown",value:function(e){27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.maintainFocus(e)}},{key:"getFocusableNodes",value:function(){var t=this.modal.querySelectorAll(e);return Array.apply(void 0,r(t))}},{key:"setFocusToFirstNode",value:function(){if(!this.config.disableFocus){var e=this.getFocusableNodes();e.length&&e[0].focus()}}},{key:"maintainFocus",value:function(e){var t=this.getFocusableNodes();if(this.modal.contains(document.activeElement)){var n=t.indexOf(document.activeElement);e.shiftKey&&0===n&&(t[t.length-1].focus(),e.preventDefault()),e.shiftKey||n!==t.length-1||(t[0].focus(),e.preventDefault())}else t[0].focus()}}]),t}(),n=null,o=function(e,t){var n=[];return e.forEach(function(e){var o=e.attributes[t].value;void 0===n[o]&&(n[o]=[]),n[o].push(e)}),n},a=function(e){if(!document.getElementById(e))return console.warn("MicroModal v0.3.2: \u2757Seems like you have missed %c'"+e+"'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","ID somewhere in your code. Refer example below to resolve it."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<div class="modal" id="'+e+'"></div>'),!1},i=function(e){if(e.length<=0)return console.warn("MicroModal v0.3.2: \u2757Please specify at least one %c'micromodal-trigger'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>'),!1},l=function(e,t){if(i(e),!t)return!0;for(var n in t)a(n);return!0},{init:function(e){var n=Object.assign({},{openTrigger:"data-micromodal-trigger"},e),a=[].concat(r(document.querySelectorAll("["+n.openTrigger+"]"))),i=o(a,n.openTrigger);if(!0!==n.debugMode||!1!==l(a,i))for(var d in i){var s=i[d];n.targetModal=d,n.triggers=[].concat(r(s)),new t(n)}},show:function(e,o){var i=o||{};i.targetModal=e,!0===i.debugMode&&!1===a(e)||(n=new t(i)).showModal()},close:function(e){e?n.closeModalById(e):n.closeModal()}}}),window.commentSubmit=function(e){e.preventDefault();var t=new FormData(e.target),n=$(e.target).parents(".comments__form"),o=[];if("Comment"===n.find("input[name*='commentable_type']")[0].value?document.upload.cachedFileArray.forEach(function(e){"image/jpeg"===e.type||"image/png"===e.type||"image/gif"===e.type?t.append("images[]",e):"pdf"===e.name.split(".")[1]||"xls"===e.name.split(".")[1]||"xlsx"===e.name.split(".")[1]||"doc"===e.name.split(".")[1]||"docx"===e.name.split(".")[1]?t.append("documents[]",e):o.push(e.name)}):upload.cachedFileArray.forEach(function(e){"image/jpeg"===e.type||"image/png"===e.type||"image/gif"===e.type?t.append("images[]",e):"pdf"===e.name.split(".")[1]||"xls"===e.name.split(".")[1]||"xlsx"===e.name.split(".")[1]||"doc"===e.name.split(".")[1]||"docx"===e.name.split(".")[1]?t.append("documents[]",e):o.push(e.name)}),!t.submiting){t.submiting=!0;var a=$("#loading");a.show();var i=$.ajax({url:"/comments",method:"POST",data:t,processData:!1,contentType:!1,dataType:"html"});upload.clearPreviewPanel(),document.getElementsByName("comment[video_url]")[0].value="",document.getElementsByName("comment_tick")[0].style.display="none",document.getElementById("modal_video").style.borderColor="#D9D9D9",document.getElementsByClassName("done_modal")[0].style.pointerEvents="none",document.getElementsByClassName("done_modal")[0].style.backgroundColor="lightgrey",document.getElementsByClassName("done_modal")[0].style.borderColor="lightgrey",document.getElementById("type_answer").value="comment",i.done(function(e){if(t.submiting=!1,n.hasClass("main_form")){var i=select(".comments__list");$(i).prepend(e);var l=$(".comments__form form").find(".message");l.val("");for(var d=l.length-1;d>=0;d--)resizeTextarea({target:l[d]},2);var s=selectAll(".js-comments-count"),r=+s[0].textContent+1;for(d=0;d<s.length;d++)s[d].textContent=r;var m,c=select(".common-more",i);c&&(m+=1,c.href=c.href.replace(/&skip_comments=\d+/,"")+"&skip_comments="+m)}else{let t=n.closest(".answers__wrapper");0===t.find(".answers__list").length&&t.append("<div class='answers__content'><button class='collapse_button'></button><div class='answers__list'></div></div>"),t.find(".answers__list").first().prepend(e),Array.from(t.find(".comment-area").children()).forEach(function(e){checkNesting(e)}),t.find(".collapse_button").length>0&&setupCollapse(t.find(".collapse_button")[0]),n.remove()}a.hide(),o.length>0&&alert("\u0424\u043e\u0440\u043c\u0430\u0442 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0444\u0430\u0439\u043b \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f:"+o.toString())}),i.fail(function(){t.submiting=!1,a.hide()})}},window.commentReply=function(e){upload.clearPreviewPanel(),e.preventDefault();let t=$(e.target).closest(".comment");if(t.find(".comments__form").length>0)t.find(".comments__form").remove(),document.getElementById("type_answer").value="comment";else{var n=$(".comments__form.main_form").clone();n.removeClass("main_form"),n.find("input[name*='commentable_type']").val("Comment"),n.find("input[name*='commentable_id']").val(t.data("id")),n.find("div.custom-file-container")[0].setAttribute("data-upload-id","uploadComment"+t.data("id")),n.find("textarea").val(""),n.find("div#imageOutput")[0].id="imageOutputComment",n.find("div#videoOutput")[0].id="videoOutputComment",n.find("input#video_url")[0].id="video_url_comment",n.find("input#modal_video")[0].id="modal_video_comment",n.find("div.video-com")[0].onclick=function(){readHidden("video_url_comment")},t.find(".answers__wrapper").first().prepend(n),document.getElementById("modal_video").style.borderColor="#D9D9D9",document.getElementsByClassName("done_modal")[0].style.pointerEvents="none",document.getElementsByClassName("done_modal")[0].style.backgroundColor="lightgrey",document.getElementsByClassName("done_modal")[0].style.borderColor="lightgrey",document.upload=new FileUploadWithPreview("uploadComment"+t.data("id")),$(document).ready(function(){document.getElementById("type_answer")&&MicroModal.init(document.getElementById("type_answer").value="answer")})}},onready(function(){let e=document.getElementsByClassName("collapse_button");Array.from(e).forEach(function(e){setupCollapse(e)}),Array.from(document.getElementsByClassName("comment")).forEach(function(e){checkNesting(e)});let t=document.getElementsByClassName("comment__replied_to");var n;Array.from(t).forEach(function(e){setReturnToTargetEvent(e)}),document.getElementById("type_answer")&&MicroModal.init(document.getElementById("type_answer").value="comment"),document.getElementById("type_answer")&&(window.upload=new FileUploadWithPreview("myUniqueUploadId")),document.getElementById("type_answer")&&document.getElementById("video_url").addEventListener("change",hiddenTick),document.getElementById("type_answer")&&document.getElementById("modal_video").addEventListener("input",validURL);var o=select(".comments");o&&(o.initialized||(n=0,o.initialized=!0),o.addEventListener("click",function(e){var t=e.target,o=t.classList.contains("js-comment-remove");if(o||(o=(t=t.parentNode).classList.contains("js-comment-remove")),o&&!t.disabled&&confirm(t.dataset.message)){t.disabled=!0;var a=t.dataset.id,i=select("#loading");i&&(i.style.display="block"),$.ajax({url:"/comments/"+a,method:"DELETE",success:function(){t.disabled=!1,selectAll(".comment_answer[data-original-comment='"+a+"']").forEach(function(e){e.remove()});var e=t.closest(".comment"),o=e.parentElement.parentElement.classList.contains("answers__list");if(o){let t=e.parentNode;e.remove(),0==t.children.length&&t.classList.add("hidden")}else{e.closest(".comment-area").remove();for(var l=selectAll(".js-comments-count"),d=+l[0].textContent-1,s=0;s<l.length;s++)l[s].textContent=d}if(i&&(i.style.display="none"),!o){var r=select(".comments__list .common-more");r&&(n-=1,r.href=r.href.replace(/&skip_comments=-?\d+/,"")+"&skip_comments="+n)}},error:function(){t.disabled=!1,i&&(i.style.display="none")}})}}),o.addEventListener("input",function(e){resizeTextarea(e,2)}))});